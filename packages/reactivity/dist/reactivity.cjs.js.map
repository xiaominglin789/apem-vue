{"version":3,"file":"reactivity.cjs.js","sources":["../../shared/src/index.ts","../src/base-handler.ts","../src/reactive.ts"],"sourcesContent":["/** 共享模块-通用方法集合 */\n\n/**\n * 判断data是否为对象类型\n * @param data \n * @returns true: 是对象类型,  false: 非对象类型\n */\nfunction isObject(data: any): boolean {\n  let flag = false;\n  if (Object.prototype.toString.call(data) === \"[object Object]\") {\n    flag = true;\n  }\n  \n  return flag;\n}\n\n\nexport {\n  isObject\n};\n","import { isObject } from \"@vue/shared\";\nimport { readonly, reactive } from \"./reactive\";\n\n/** 响应式对象-get */\nconst get = createGetter(false, false);\n/** 仅第一层响应式对象-get */\nconst shollawReactiveGetter = createGetter(false, true);\n/** 全部属性仅读对象-get */\nconst readonlyGetter = createGetter(true, false);\n/** 仅第一层只读对象-get */\nconst shollawReadonlyGetter = createGetter(true, true);\n/** 响应式对象-set */\nconst set = createSetter(false);\n/** 仅第一层响应式对象-set */\nconst shollawReactiveSetter = createSetter(true);\n\n/**\n * getter读取\n * @param isReadonly 是否为仅读, true: readonly仅读, false: 响应式proxy\n * @param isShollaw 是否为仅作用于第一层, true: 仅作用于第一层， false: 全部嵌套属性都仅读或响应式\n * @returns \n */\nfunction createGetter(isReadonly=false, isShollaw=false) {\n  return function get(target: object, key: string, recevier: object) {\n    const result = Reflect.get(target, key, recevier);\n\n    if (!isReadonly) {\n      // 只读的对象不做依赖收集\n      // 响应式对象-才作依赖收集\n    }\n\n    if (isShollaw) {\n      // 只有第一层是响应式属性\n      return result;\n    } \n    \n    if (isObject(result)) {\n      // 当取值时才进行代理\n      // 判断对象类型，只读属性，递归包装\n      return isReadonly ? readonly(result) : reactive(result);\n    }\n\n    return result;\n  }\n}\n\n/**\n * setter写入(只有响应式数据才能修改)\n * @param isShollaw 是否为仅作用于第一层, true: 仅作用于第一层， false: 全部嵌套属性都响应式\n */\nfunction createSetter(isShollaw=false) {\n  return function set(target: object, key: string, newValue: any, recevier: object) {\n    const result = Reflect.set(target, key, newValue, recevier);\n    \n    if (isShollaw) {\n      // true\n    } else {\n      // false\n    }\n\n\n    return result;\n  }\n}\n\n/** reactive包装-get/set处理 */\nconst handleReactive = {\n  get,\n  set,\n}\n\n/** shallowReactive包装-get/set处理 */\nconst handleShollawReactive = {\n  get: shollawReactiveGetter,\n  set: shollawReactiveSetter\n}\n\n/** readonly包装-get/set处理 */\nconst handleReadonly = {\n  get: readonlyGetter,\n  set: (target: object, key: string) => {\n    console.warn(target, \" 所有属性都是只读, 无法修改\");\n    return false;\n  }\n}\n\n/** shallowReadonly包装-get/set处理 */\nconst handleShollawReadonly = {\n  get: shollawReadonlyGetter,\n  set: (target: object, key: string) => {\n    console.warn(target, \" 的属性:\", key, \" 属性是只读的, 无法修改\");\n    return false;\n  }\n}\n\nexport {\n  handleReactive,\n  handleShollawReactive,\n  handleReadonly,\n  handleShollawReadonly,\n}\n","import { isObject } from \"@vue/shared/src\";\nimport {\n  handleReactive,\n  handleShollawReactive,\n  handleReadonly,\n  handleShollawReadonly,\n} from \"./base-handler\";\n\n/** 响应式数据-代理对象map */\nconst reactiveProxyMap = new WeakMap();\n/** 只读数据-代理对象map */\nconst readonlyProxyMap = new WeakMap();\n\n/**\n * 根据配置创建代理对象\n * @param target 数据源\n * @param isReadonly 是否仅读\n * @param handle get/set-处理配置项\n */\nfunction createReactiveObject(target: object, isReadonly: boolean, handle: ProxyHandler<object>) {\n  /**\n   * 1.数据源是不是对象类型, 非对象的数据源直接返回\n   * 2.数据源是否已被代理过了,有代理则直接返回代理的数据\n   *   - 数据源是不是只读的, 取到对应的数据缓存\n   *   - 没有缓存,则存入缓存中、\n   */\n  if (!isObject(target)) {\n    return target;\n  }\n\n  const proxyMap = isReadonly ? readonlyProxyMap : reactiveProxyMap;\n\n  if (proxyMap.has(target)) {\n    // 有缓存, 返回缓存\n    return proxyMap.get(target);\n  }\n\n  // 无缓存, 先存缓存\n  const targetProxy = new Proxy(target, handle);\n  proxyMap.set(target, targetProxy);\n\n  return targetProxy;\n}\n\n\n/** reactive包装: 所有深度的属性都被包装成proxy */\nfunction reactive(data: any) {\n  return createReactiveObject(data, false, handleReactive);\n}\n\n/** shallowReactive包装: 只有第一层属性会被包装成proxy,其他层不会 */\nfunction shallowReactive(data: any) {\n  return createReactiveObject(data, false, handleShollawReactive);\n}\n\n/** readonly包装: 所有属性都是只读,不能改 */\nfunction readonly(data: any) {\n  return createReactiveObject(data, true, handleReadonly);\n}\n\n/**\n * shallowReadonly包装: 只有第一层属性是只读的,其他层的可读可改\n */\nfunction shallowReadonly(data: any) {\n  return createReactiveObject(data, true, handleShollawReadonly);\n}\n\nexport {\n  reactive,\n  shallowReactive,\n  readonly,\n  shallowReadonly\n};\n"],"names":[],"mappings":"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"}